<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8584771</versionUuid>
    <rule>
        <name>RC_IF_DocumentacionAdicional</name>
        <uuid>_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8535677</uuid>
        <description>Interfaz que contiene la sección Documentación Adicional para el alta de incidencias</description>
        <parentUuid>_a-0000e480-7e67-8000-9ba2-011c48011c48_8288662</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>load(
  local!nulo,
  /*variables donde se guarda la info para luego añadir al grid*/
  
  /*QUERIES*/
  
  /*Historical Chat*/
  /*---Introducción---*/
  local!comentarios: {
    comentario: null,
    adjunto: null
  },
  /*---Lista----*/
  local!paginacion: #"SYSTEM_SYSRULES_pagingInfo"(1, 10, #"SYSTEM_SYSRULES_sortInfo"(field: "FechaComentario", ascending: true)),
  local!ascendente: {
    Grupo: true,
    Usuario: true,
    Comentario: true,
    Fecha: true,
    Adjunto: true
  },
  {
    #"SYSTEM_SYSRULES_sectionLayout_v1"(
      label: index(ri!labels, "incidencia.documentacion.seccion"),
      contents: {
        with(
          local!datospaginados: todatasubset(ri!Documentacion, local!paginacion),
          {
            #"SYSTEM_SYSRULES_columnsLayout"(
              columns: {
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_paragraphField"(
                      label: upper("Comentario"),
                      labelPosition: "ABOVE",
                      value: local!comentarios.comentario,
                      saveInto: local!comentarios.comentario,
                      refreshAfter: "UNFOCUS",
                      height: "MEDIUM",
                      validations: if(
                        len(local!comentarios.comentario) &gt; 255,
                        "La longitud del valor no puede ser superior a 255 caracteres. Ha escrito " &amp; len(local!comentarios.comentario) &amp; " caracteres.",
                        null
                      )
                      /*,*/
                      /*disabled: local!mantenimiento*/
                    )
                  }
                ),
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_sideBySideLayout"(
                      items: {
                        #"SYSTEM_SYSRULES_sideBySideItem"(
                          item: #"SYSTEM_SYSRULES_fileUploadField_v1"(
                            label: upper("Adjuntar Archivo"),
                            labelPosition: "ABOVE",
                            target: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8543633",
                            maxSelections: 1,
                            value: local!comentarios.adjunto,
                            saveInto: local!comentarios.adjunto,
                            validations: if(
                              fv!files.size &gt; 950000000, 
                              "El tamaño del documento no debe ser mayor de 950MB. Por favor, elimine el documento: " &amp; 
                              index(fv!files, "name", where(fv!files.size &gt; 950000000), {}), 
                              null
                            )
                            /*,*/
                            /*disabled: local!mantenimiento*/
                          )
                        ),
                        #"SYSTEM_SYSRULES_sideBySideItem"(
                          item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                            label: "",
                            labelPosition: "COLLAPSED",
                            value: {
                              #"SYSTEM_SYSRULES_richTextIcon"(
                                icon: "plus",
                                caption: upper("Añadir Comentario"),
                                link: #"SYSTEM_SYSRULES_dynamicLink"(
                                  value: 'type!{urn:com:appian:types:RC}RC_CDT_DocumentacionAdicional'(
                                    Grupo: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8540138"(loggedInUser()),
                                    Usuario: concat(user(loggedInUser(), "firstName"), " ", user(loggedInUser(), "lastName")),
                                    Comentario: local!comentarios.comentario,
                                    DocumentoAdjunto: local!comentarios.adjunto,
                                    IdIncidencia: ri!Incidencia.IdIncidencia,
                                    ctlUsuarioCreacion: loggedInUser(),
                                    ctlFechaCreacion: now(),
                                    ctlUsuarioModificacion: loggedInUser(),
                                    ctlFechaModificacion: now(),
                                    ctlEstado: true()
                                  ),
                                  saveInto: {
                                    a!save(ri!Documentacion, append(ri!Documentacion, save!value)),
                                    a!save({local!comentarios.comentario, local!comentarios.adjunto}, null)
                                  }
                                ),
                                color: "ACCENT",
                                size: "MEDIUM"
                              )
                            },
                            showWhen: and(
                              not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!comentarios.comentario)),
                              len(local!comentarios.comentario) &lt; 255
                            )
                          )
                        )
                      },
                      alignvertical: "MIDDLE"
                    )
                  }
                )
              }
            ),
            #"SYSTEM_SYSRULES_columnsLayout"(
              columns: {
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_cardLayout"(
                      contents: {
                        #"SYSTEM_SYSRULES_sideBySideLayout"(
                          items: {
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                value: {
                                  if(
                                    local!paginacion.sort.field = "Grupo",
                                    if(
                                      local!ascendente.Grupo,
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-asc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      ),
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-desc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      )
                                    ),
                                    {}
                                  ),
                                  #"SYSTEM_SYSRULES_richTextItem_v1"(
                                    text: {"Grupo"},
                                    link: #"SYSTEM_SYSRULES_dynamicLink"(
                                      value: #"SYSTEM_SYSRULES_sortInfo"(field: "Grupo", ascending: local!ascendente.Grupo),
                                      saveInto: {
                                        local!paginacion.sort,
                                        a!save(local!ascendente.Grupo, not(local!ascendente.Grupo))
                                      }
                                    ),
                                    size: "MEDIUM",

                                    style: {
                                      "STRONG"
                                    }
                                  )
                                },
                                align: "CENTER"
                              )
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "ABOVE",
                                align: "LEFT"
                              ),
                              width: "MINIMIZE"
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                value: {
                                  if(
                                    local!paginacion.sort.field = "Usuario",
                                    if(
                                      local!ascendente.Usuario,
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-asc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      ),
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-desc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      )
                                    ),
                                    {}
                                  ),
                                  #"SYSTEM_SYSRULES_richTextItem_v1"(
                                    text: {"Usuario"},
                                    link: #"SYSTEM_SYSRULES_dynamicLink"(
                                      value: #"SYSTEM_SYSRULES_sortInfo"(field: "Usuario", ascending: local!ascendente.Usuario),
                                      saveInto: {
                                        local!paginacion.sort,
                                        a!save(local!ascendente.Usuario, not(local!ascendente.Usuario))
                                      }
                                    ),
                                    size: "MEDIUM",
                                    style: {
                                      "STRONG"
                                    }
                                  )
                                },
                                align: "CENTER"
                              )
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                value: {
                                  if(
                                    local!paginacion.sort.field = "Comentario",
                                    if(
                                      local!ascendente.Comentario,
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-asc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      ),
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-desc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      )
                                    ),
                                    {}
                                  ),
                                  #"SYSTEM_SYSRULES_richTextItem_v1"(
                                    text: {"Comentario"},
                                    link: #"SYSTEM_SYSRULES_dynamicLink"(
                                      value: #"SYSTEM_SYSRULES_sortInfo"(field: "Comentario", ascending: local!ascendente.Comentario),
                                      saveInto: {
                                        local!paginacion.sort,
                                        a!save(local!ascendente.Comentario, not(local!ascendente.Comentario))
                                      }
                                    ),
                                    size: "MEDIUM",
                                    style: {
                                      "STRONG"
                                    }
                                  )
                                },
                                align: "CENTER"
                              )
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                value: {
                                  if(
                                    local!paginacion.sort.field = "ctlFechaAlta",
                                    if(
                                      local!ascendente.Fecha,
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-asc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      ),
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon:"sort-desc",
                                        color: "ACCENT",
                                        size:"MEDIUM"
                                      )
                                    ),
                                    {}
                                  ),
                                  #"SYSTEM_SYSRULES_richTextItem_v1"(
                                    text: {"Fecha"},
                                    link: #"SYSTEM_SYSRULES_dynamicLink"(
                                      value: #"SYSTEM_SYSRULES_sortInfo"(field: "ctlFechaAlta", ascending: local!ascendente.Fecha),
                                      saveInto: {
                                        local!paginacion.sort,
                                        a!save(local!ascendente.Fecha, not(local!ascendente.Fecha))
                                      }
                                    ),
                                    size: "MEDIUM",
                                    style: {
                                      "STRONG"
                                    }
                                  )
                                },
                                align: "CENTER"
                              )
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                value: #"SYSTEM_SYSRULES_richTextImage"(
                                  image: #"SYSTEM_SYSRULES_documentImage"(
                                    document: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8584741",
                                    link: #"SYSTEM_SYSRULES_dynamicLink"(
                                      value: #"SYSTEM_SYSRULES_sortInfo"(field: "DocumentoAdjunto", ascending: local!ascendente.Adjunto),
                                      saveInto: {
                                        local!paginacion.sort,
                                        a!save(local!ascendente.Adjunto, not(local!ascendente.Adjunto))
                                      }
                                    )
                                  )
                                )
                              ),
                              width: "MINIMIZE"
                            )
                          },
                          alignvertical: "BOTTOM"
                        )
                      },
                      style: "STANDARD",
                      height: "AUTO",
                      marginBelow: "STANDARD"
                    ),
                    #"SYSTEM_SYSRULES_forEach"(
                      local!datospaginados,
                      #"SYSTEM_SYSRULES_cardLayout"(
                        contents: {
                          #"SYSTEM_SYSRULES_sideBySideLayout"(
                            items: {
                              #"SYSTEM_SYSRULES_sideBySideItem"(
                                item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                  label: "",
                                  labelPosition: "COLLAPSED",
                                  value: {
                                    #"SYSTEM_SYSRULES_richTextItem_v1"(
                                      text: group(fv!item.Grupo,"groupName"),
                                      color: "STANDARD"
                                    )
                                  },
                                  align: "CENTER"
                                )
                              ),
                              #"SYSTEM_SYSRULES_sideBySideItem"(
                                item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                  label: "",
                                  labelPosition: "COLLAPSED",
                                  value: {
                                    #"SYSTEM_SYSRULES_richTextItem_v1"(
                                      text: fv!item.Usuario,
                                      color: "STANDARD"
                                    )
                                  },
                                  align: "CENTER"
                                )
                              ),
                              #"SYSTEM_SYSRULES_sideBySideItem"(
                                item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                  label: "",
                                  labelPosition: "COLLAPSED",
                                  value: {
                                    #"SYSTEM_SYSRULES_richTextItem_v1"(
                                      text: fv!item.Comentario,
                                      color: "STANDARD"
                                    )
                                  },
                                  align: "CENTER"
                                )
                              ),
                              #"SYSTEM_SYSRULES_sideBySideItem"(
                                item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                  label: "",
                                  labelPosition: "COLLAPSED",
                                  value: {
                                    #"SYSTEM_SYSRULES_richTextItem_v1"(
                                      text: fv!item.ctlFechaCreacion,
                                      color: "STANDARD"
                                    )
                                  },
                                  align: "CENTER"
                                )
                              ),
                              #"SYSTEM_SYSRULES_sideBySideItem"(
                                item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                  label: "",
                                  labelPosition: "COLLAPSED",
                                  value: {
                                    if(
                                      #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(fv!item.DocumentoAdjunto),
                                      #"SYSTEM_SYSRULES_richTextImage"(
                                        image: #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"_a-0000e440-724e-8000-9ba2-011c48011c48_7806148"
                                        )
                                      ),
                                      {
                                        #"SYSTEM_SYSRULES_richTextIcon"(
                                          icon: "download",
                                          caption: upper("Descargar Adjunto"),
                                          link: #"SYSTEM_SYSRULES_documentDownloadLink"(
                                            document: fv!item.DocumentoAdjunto
                                          ),
                                          color: "STANDARD",
                                          size: "MEDIUM"
                                        ),
                                        #"SYSTEM_SYSRULES_richTextItem_v1"(
                                          text: repeat(2, " ")
                                        )
                                      }
                                    )
                                  },
                                  align: "CENTER"
                                ),
                                width: "MINIMIZE"
                              )
                            },
                            alignVertical: "MIDDLE"
                          )
                        },
                        style: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8542225"(Grupo: fv!item.Grupo),
                        height: "AUTO",
                        marginBelow: "NONE"
                      )
                    ),
                    #"SYSTEM_SYSRULES_richTextDisplayField"(
                      label: "",
                      labelPosition: "COLLAPSED",
                      value: {
                        #"SYSTEM_SYSRULES_richTextIcon"(
                          icon: "arrow-left",
                          caption: "Página anterior",
                          link: if(
                            local!paginacion.startIndex = 1,
                            null,
                            #"SYSTEM_SYSRULES_dynamicLink"(
                              saveInto: {
                                a!save(
                                  local!paginacion.startIndex,
                                  local!paginacion.startIndex - local!paginacion.batchSize
                                )
                              }
                            )
                          ),
                          color: if(
                            local!paginacion.startIndex = 1,
                            "STANDARD",
                            "ACCENT"
                          )
                        ),
                        #"SYSTEM_SYSRULES_richTextItem_v1"(
                          text: {
                            #"SYSTEM_SYSRULES_richTextItem_v1"(
                              text: if(
                                local!datospaginados.totalCount &lt; local!paginacion.batchSize,
                                local!paginacion.startIndex &amp; " - " &amp; local!datospaginados.totalCount,
                                local!paginacion.startIndex &amp; " - " &amp; (min(local!paginacion.startIndex + local!paginacion.batchSize - 1, local!datospaginados.totalCount))
                              ),
                              style: "STRONG"
                            ),
                            #"SYSTEM_SYSRULES_richTextItem_v1"(
                              text: " de " &amp; local!datospaginados.totalCount &amp; " "
                            )
                          }
                        ),
                        #"SYSTEM_SYSRULES_richTextIcon"(
                          icon: "arrow-right",
                          link: if(
                            (local!paginacion.startIndex + local!paginacion.batchSize) &gt; local!datospaginados.totalCount,
                            null,
                            #"SYSTEM_SYSRULES_dynamicLink"(
                              saveInto: {
                                a!save(
                                  local!paginacion.startIndex,
                                  local!paginacion.startIndex + local!paginacion.batchSize
                                )
                              }
                            )
                          ),
                          color: if(
                            (local!paginacion.startIndex + local!paginacion.batchSize) &gt; local!datospaginados.totalCount,
                            "STANDARD",
                            "ACCENT"
                          )
                        ),
                        #"SYSTEM_SYSRULES_richTextItem_v1"(
                          text: repeat(1, char(9))
                        )
                      },
                      align: "RIGHT"
                    )
                  }
                )
              },
              showwhen: not(local!datospaginados.totalCount = 0)
            )
          }
        )
      },
      isCollapsible: true(),
      isInitiallyCollapsed: true()
    )
    /*,a!debugInterface()*/
  }
)</definition>
        <namedTypedValue>
            <name>labels</name>
            <type>
                <name>Variant</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>Incidencia</name>
            <type>
                <name>RC_CDT_Incidencia</name>
                <namespace>urn:com:appian:types:RC</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>proceso</name>
            <type>
                <name>ProcessModel</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>idiomaEsp</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>Documentacion</name>
            <type>
                <name>RC_CDT_DocumentacionAdicional?list</name>
                <namespace>urn:com:appian:types:RC</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name/>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e480-7e67-8000-9ba2-011c48011c48_8412556"()</a:value>
                    <a:nameRef>labels</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">'type!{urn:com:appian:types:RC}RC_CDT_Incidencia'('ServicioAfectado': true)</a:value>
                    <a:nameRef>Incidencia</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="a:ProcessModel"/>
                    <a:nameRef>proceso</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:boolean">true</a:value>
                    <a:nameRef>idiomaEsp</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:nameRef>Documentacion</a:nameRef>
                    <a:id>5</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8584771"/>
    </history>
</contentHaul>
