<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8584709</versionUuid>
    <rule>
        <name>RC_IF_DatosIncidencias</name>
        <uuid>_a-0000e49c-9d0b-8000-9ba2-011c48011c48_8445074</uuid>
        <description>Interfaz que muestra los datos de una incidencia</description>
        <parentUuid>_a-0000e480-7e67-8000-9ba2-011c48011c48_8288662</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>load(
  /*---- Variables de Multidioma ----*/
  local!idiomaEsp: contains(#"_a-0000e480-7e67-8000-9ba2-011c48011c48_8422019", userlocale(loggedInUser())),
  local!labels: #"_a-0000e480-7e67-8000-9ba2-011c48011c48_8412556"(),
  /*---- Variables de la Incidencia ----*/ 
  /*--- Variables de direcciones ---*/
  local!queryDireccionesSBGM: #"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8522217"(Ids: null, Direccion: null, Area: null, IdPais: 1, Estado: true()),
  local!queryDireccionesNoSBGM: #"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8522223"(Ids: null, Direccion: null, IdPais: 1, Estado: true()),
  /*--- Reportada ---*/
  local!queryUsuarioLogado: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8560119"(Usuario: loggedInUser()),
  local!UsuarioLogado: if(
    local!queryUsuarioLogado.totalCount = 0,
    {},
    local!queryUsuarioLogado.data
  ),
  /*--- Responsable ---*/
  local!DireccionesSeleccionadas: {},
  local!AreasSeleccionadas: {},
  local!AreasGuardadas,
  local!paginacionDireccionesResponsables: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 5
  ),
  /*--- Afectada ---*/
  local!queryDireccionesAfectadasSBGM: if(
    local!queryDireccionesSBGM.totalCount = 0,
    todatasubset({}),
    todatasubset(union(local!queryDireccionesSBGM.data.Direccion, local!queryDireccionesSBGM.data.Direccion))
  ),
  local!direccionesAfectadasSeleccionadas: {},
  local!direccionesAfectadasGuardadas: {},
  local!paginacionDireccionesAfectadas: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 3
  ),
  /*---- Variables de Causa Raíz ----*/
  local!queryCausasRaices: #"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8515401"(Estado: true()),
  local!CausasRaices: if(
    local!queryCausasRaices.totalCount = 0,
    {},
    local!queryCausasRaices.data
  ),
  local!causaRaicesSeleccionadas,
  local!causaRaicesGuardadas,
  local!paginacionCausaRaiz: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 3
  ),
  /*---- Variables de Categoría del Riesgo ----*/
  local!queryCategoriaRiesgo: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8573598"(Estado: true()),
  local!CategoriasRiesgos: if(
    local!queryCategoriaRiesgo.totalCount = 0,
    {},
    local!queryCategoriaRiesgo.data
  ),
  local!categoriasRiesgosSeleccionadas,
  local!categoriasRiesgosGuardadas,
  local!paginacionCategoriaRiesgo: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 3
  ),
  /*---- Variables de Producto Afectado ----*/
  local!queryProductoAfectado: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8576101"(Estado: true()),
  local!ProductosAfectados: if(
    local!queryProductoAfectado.totalCount = 0,
    {},
    local!queryProductoAfectado.data
  ),
  local!productosAfectadosSeleccionados,
  local!productosAfectadosGuardados,
  local!paginacionProductoAfectado: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 3
  ),
  /*---- Variables de Control ID ----*/
  local!queryControlIDHeracles: #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8582704"(Estado: true()),
  local!ControlIDHeracles: if(
    local!queryControlIDHeracles.totalCount = 0,
    {},
    local!queryControlIDHeracles.data
  ),
  local!ControlIDHeraclesDropdown: index(
    local!ControlIDHeracles,
    wherecontains(
      tostring(
        index(
          index(local!queryDireccionesSBGM.data, "Direccion"),
          wherecontains(
            index(local!UsuarioLogado, "IdDireccion", {}),
            index(local!queryDireccionesSBGM.data, "IdDireccion", {})
          )
        )
      ),
      touniformstring(index(local!ControlIDHeracles, "Direccion", {}))
    )
  ),
  local!controlesHeraclesSeleccionados,
  local!controlesHeraclesGuardados,
  local!paginacionControlesHeracles: #"SYSTEM_SYSRULES_pagingInfo"(
    startIndex: 1,
    batchSize: 3
  ),
  /*---- RC_IF_Geografia ----*/
  local!geografias,
  local!impactos,
  local!docu,
  /*---- Variables de control ----*/
  local!vacia,
  {
    #"SYSTEM_SYSRULES_boxLayout"(
      label: "Alta Incidencias",
      contents: {
        #"SYSTEM_SYSRULES_cardLayout"(
          contents: {
            #"SYSTEM_SYSRULES_columnsLayout"(
              columns: {
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_richTextDisplayField"(
                      label: index(local!labels, "incidencia.descripcion.codigo"),
                      labelPosition: "ABOVE",
                      value: {
                        #"SYSTEM_SYSRULES_richTextItem_v1"(
                          text: {index(index(ri!Incidencia, "DatosGenerales", {}), "IdIncidencia", null)},
                          size: "STANDARD",
                          style: {
                            "STRONG"
                          }
                        )
                      }
                    ),
                    #"SYSTEM_SYSRULES_dateField"(
                      label: index(local!labels, "incidencia.descripcion.fecha-comunicacion"),
                      labelPosition: "JUSTIFIED",
                      value: if(
                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "FechaComunicacion", null)),
                        today(),
                        index(index(ri!Incidencia, "DatosGenerales", {}), "FechaComunicacion", null)
                      ),
                      saveInto: ri!Incidencia.DatosGenerales.FechaComunicacion,
                      readonly: false,
                      disabled: true
                    )
                  }
                ),
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_richTextDisplayField"(
                      label: index(local!labels, "incidencia.descripcion.direccion-reportada"),
                      labelPosition: "ABOVE",
                      value: {
                        #"SYSTEM_SYSRULES_richTextItem_v1"(
                          text: index(
                            index(local!queryDireccionesSBGM.data, "Direccion"),
                            wherecontains(
                              index(local!UsuarioLogado, "IdDireccion", {}),
                              index(local!queryDireccionesSBGM.data, "IdDireccion", {})
                            )
                          ),
                          size: "STANDARD",
                          style: {}
                        )
                      }
                    ),
                    #"SYSTEM_SYSRULES_dateField"(
                      label: index(local!labels, "incidencia.descripcion.fecha-deteccion"),
                      labelPosition: "JUSTIFIED",
                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "FechaDeteccion", null),
                      saveInto: ri!Incidencia.DatosGenerales.FechaDeteccion,
                      required: true
                    )
                  }
                ),
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_richTextDisplayField"(
                      label: index(local!labels, "incidencia.descripcion.area-reportada"),
                      labelPosition: "ABOVE",
                      value: {
                        #"SYSTEM_SYSRULES_richTextItem_v1"(
                          text: index(
                            if(
                              local!idiomaEsp,
                              index(local!queryDireccionesSBGM.data, "AreaEsp"),
                              index(local!queryDireccionesSBGM.data, "AreaEng")
                            ),
                            wherecontains(
                              index(local!UsuarioLogado, "IdDireccion", {}),
                              index(local!queryDireccionesSBGM.data, "IdDireccion", {})
                            )
                          ),
                          size: "STANDARD",
                          style: {}
                        )
                      }
                    ),
                    #"SYSTEM_SYSRULES_dateField"(
                      label: index(local!labels, "incidencia.descripcion.fecha-ocurrencia"),
                      labelPosition: "JUSTIFIED",
                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "FechaOcurrencia", null),
                      saveInto: ri!Incidencia.DatosGenerales.FechaOcurrencia,
                      required: true
                    )
                  }
                )
              }
            )
          },
          style: "WARN",
          height: "AUTO",
          marginBelow: "STANDARD"
        ),
        /*a!debugInterface(),*/
        #"SYSTEM_SYSRULES_sectionLayout_v1"(
          label: index(local!labels, "incidencia.descripcion.seccion"),
          contents: {
            #"SYSTEM_SYSRULES_cardLayout"(
              contents: {
                #"SYSTEM_SYSRULES_sideBySideLayout"(
                  items: {
                    #"SYSTEM_SYSRULES_sideBySideItem"(
                      item: #"SYSTEM_SYSRULES_dropdownField"(
                        label: index(local!labels, "incidencia.descripcion.clasificacion"),
                        labelPosition: "ABOVE",
                        placeholderLabel: index(local!labels,"general.placeholder-dropdown"),
                        choiceLabels: if(
                          local!idiomaEsp,
                          #"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8523705",
                          #"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8523715"
                        ),
                        choiceValues: enumerate(length(#"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8523705"))+1,
                        value: index(index(ri!Incidencia, "DatosGenerales", {}), "Clasificacion"),
                        saveInto: ri!Incidencia.DatosGenerales.Clasificacion,
                        required: true,
                        validations: {}
                      ),
                      width: "MINIMIZE"
                    ),
                    #"SYSTEM_SYSRULES_sideBySideItem"(
                      item: #"SYSTEM_SYSRULES_radioButtonField"(
                        label: index(local!labels, "incidencia.descripcion.escalar-control"),
                        choiceLabels: {
                          index(local!labels, "general.si"),
                          index(local!labels, "general.no")
                        },
                        choiceValues: {
                          true(),
                          false()
                        },
                        value: index(index(ri!Incidencia, "DatosGenerales", {}), "EscalarControl", null),
                        saveInto: ri!Incidencia.DatosGenerales.EscalarControl,
                        required: true,
                        choicelayout: "COMPACT"
                      ),
                      width: "MINIMIZE"
                    ),
                    #"SYSTEM_SYSRULES_sideBySideItem"(
                      item: #"SYSTEM_SYSRULES_radioButtonField"(
                        label: index(local!labels, "incidencia.descripcion.criticidad"),
                        choiceLabels: {
                          index(local!labels, "general.si"),
                          index(local!labels, "general.no")
                        },
                        choiceValues: {
                          true(),
                          false()
                        },
                        value: index(index(ri!Incidencia, "DatosGenerales", {}), "Criticidad", null),
                        saveInto: ri!Incidencia.DatosGenerales.Criticidad,
                        choicelayout: "COMPACT"
                      ),
                      width: "MINIMIZE"
                    ),
                    #"SYSTEM_SYSRULES_sideBySideItem"(
                      item: #"SYSTEM_SYSRULES_textField"(
                        label: index(local!labels, "incidencia.descripcion.titulo"),
                        labelPosition: "ABOVE",
                        value: index(index(ri!Incidencia, "DatosGenerales", {}), "Titulo", null),
                        saveInto: ri!Incidencia.DatosGenerales.Titulo,
                        validations: if(
                          len(index(index(ri!Incidencia, "DatosGenerales", {}), "Titulo", null)) &gt; 255,
                          "La longitud del valor no puede ser superior a 255 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "Titulo", null)) &amp; " caracteres.",
                          null
                        )
                      )
                    )
                  }
                ),
                #"SYSTEM_SYSRULES_paragraphField"(
                  label: index(local!labels, "incidencia.descripcion.descripcion"),
                  labelPosition: "JUSTIFIED",
                  value: index(index(ri!Incidencia, "DatosGenerales", {}), "Descripcion", null),
                  saveInto: ri!Incidencia.DatosGenerales.Descripcion,
                  validations: if(
                    len(index(index(ri!Incidencia, "DatosGenerales", {}), "Descripcion", null)) &gt; 1000,
                    "La longitud del valor no puede ser superior a 1000 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "Descripcion", null)) &amp; " caracteres.",
                    null
                  )
                ),
                #"SYSTEM_SYSRULES_boxLayout"(
                  label: index(local!labels, "incidencia.descripcion.responsable"),
                  contents: {
                    #"SYSTEM_SYSRULES_sideBySideLayout"(
                      items: {
                        #"SYSTEM_SYSRULES_sideBySideItem"(
                          item: #"SYSTEM_SYSRULES_radioButtonField"(
                            label: index(local!labels, "incidencia.descripcion.entidad-responsable"),
                            labelposition: "JUSTIFIED",
                            choiceLabels: {
                              index(local!labels, "general.SBMG"),
                              index(local!labels, "general.no") &amp; " " &amp; index(local!labels, "general.SBMG")
                            },
                            choiceValues: {
                              true(),
                              false()
                            },
                            value: index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null),
                            saveInto: {
                              ri!Incidencia.DatosGenerales.EntidadResponsable,
                              a!save(local!DireccionesSeleccionadas, {}),
                              a!save(local!AreasSeleccionadas, {})
                            },
                            disabled: not(
                              #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                index(
                                  ri!Incidencia.Direcciones,
                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                  {}
                                )
                              )
                            ),
                            choicelayout: "STACKED"
                          ),
                          width: "MINIMIZE"
                        ),
                        with(
                          /*--- Dropdown Dirección Responsable ---*/
                          local!queryDireccionesResponsablesDropdown: if(
                            #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null)),
                            todatasubset({}),
                            if(
                              index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", true()),
                              if(
                                local!queryDireccionesSBGM.totalCount = 0,
                                todatasubset({}),
                                todatasubset(union(local!queryDireccionesSBGM.data.Direccion, local!queryDireccionesSBGM.data.Direccion))
                              ),
                              if(
                                local!queryDireccionesSBGM.totalCount = 0,
                                todatasubset({}),
                                todatasubset(union(local!queryDireccionesNoSBGM.data.Direccion, local!queryDireccionesNoSBGM.data.Direccion))
                              )
                            )
                          ),
                          /*--- Dropdown Área Responsable ---*/
                          local!queryAreasDropdown: if(
                            or(
                              #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null)),
                              #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!DireccionesSeleccionadas)
                            ),
                            todatasubset({}),
                            if(
                              index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", true()),
                              if(
                                local!queryDireccionesSBGM.totalCount = 0,
                                todatasubset({}),
                                todatasubset(index(local!queryDireccionesSBGM.data, wherecontains(touniformstring(local!DireccionesSeleccionadas), touniformstring(local!queryDireccionesSBGM.data.Direccion)), {}))
                              ),
                              todatasubset({})
                            )
                          ),
                          {
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                label: index(local!labels, "incidencia.descripcion.direccion-responsable"),
                                labelPosition: "ABOVE",
                                instructions: if(
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null)),
                                  null,
                                  if(
                                    local!queryDireccionesResponsablesDropdown.totalCount = 0,
                                    "No se han encontrado datos en la BBDD",
                                    null
                                  )
                                ),
                                choiceLabels: local!queryDireccionesResponsablesDropdown.data,
                                choiceValues: if(
                                  index(ri!Incidencia.DatosGenerales, "EntidadResponsable", true()),
                                  local!queryDireccionesResponsablesDropdown.data,
                                  a!flatten(
                                    #"SYSTEM_SYSRULES_forEach"(
                                      local!queryDireccionesResponsablesDropdown.data,
                                      index(local!queryDireccionesNoSBGM.data, wherecontains(fv!item, touniformstring(index(local!queryDireccionesNoSBGM.data, "Direccion", {}))))
                                    )
                                  )
                                ),
                                value: local!DireccionesSeleccionadas,
                                saveInto: {
                                  local!DireccionesSeleccionadas,
                                  if(
                                    #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!AreasSeleccionadas),
                                    a!save(local!vacia,null),
                                    a!save(
                                      local!AreasSeleccionadas,
                                      a!flatten(
                                        #"SYSTEM_SYSRULES_forEach"(
                                          local!AreasSeleccionadas,
                                          if(
                                            contains(local!DireccionesSeleccionadas, fv!item.Direccion),
                                            fv!item,
                                            {}
                                          )
                                        )
                                      )
                                    )
                                  )
                                },
                                disabled: or(
                                  local!queryDireccionesResponsablesDropdown.totalCount = 0,
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null))
                                ),
                                validations: {}
                              ),
                              width: "AUTO"
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                label: index(local!labels, "incidencia.descripcion.area-reponsable"),
                                labelPosition: "ABOVE",
                                instructions: if(
                                  or(
                                    #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null)),
                                    #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!DireccionesSeleccionadas)
                                  ),
                                  null,
                                  if(
                                    local!queryAreasDropdown.totalCount = 0,
                                    "No se han encontrado datos en la BBDD",
                                    null
                                  )
                                ),
                                choiceLabels: if(
                                  local!idiomaEsp,
                                  #"SYSTEM_SYSRULES_forEach"(
                                    local!queryAreasDropdown.data,
                                    concat(index(fv!item, "Direccion", {}),"-",index(fv!item, "AreaEsp", {}))
                                  ),
                                  #"SYSTEM_SYSRULES_forEach"(
                                    local!queryAreasDropdown.data,
                                    concat(index(fv!item, "Direccion", {}),"-",index(fv!item, "AreaEng", {}))
                                  )
                                ),
                                choiceValues: local!queryAreasDropdown.data,
                                value: local!AreasSeleccionadas,
                                saveInto: local!AreasSeleccionadas,
                                disabled: or(
                                  local!queryAreasDropdown.totalCount = 0,
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!DireccionesSeleccionadas)
                                ),
                                validations: {}
                              ),
                              width: "AUTO",
                              showWhen: if(
                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", null)),
                                true(),
                                index(index(ri!Incidencia, "DatosGenerales", {}), "EntidadResponsable", false())
                              )
                            ),
                            #"SYSTEM_SYSRULES_sideBySideItem"(
                              item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                value: {
                                  #"SYSTEM_SYSRULES_richTextIcon"(
                                    icon: "plus",
                                    caption: index(local!labels, "general.añadir"),
                                    link: #"SYSTEM_SYSRULES_dynamicLink"(
                                      value: if(
                                        index(ri!Incidencia.DatosGenerales, "EntidadResponsable", true()),
                                        #"SYSTEM_SYSRULES_forEach"(
                                          local!AreasSeleccionadas,
                                          if(
                                            or(
                                              #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                                index(
                                                  ri!Incidencia.Direcciones,
                                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                  {}
                                                )
                                              ),
                                              not(
                                                contains(
                                                  index(
                                                    index(ri!Incidencia.Direcciones, "IdDireccionArea", {}),
                                                    wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                    {}
                                                  ),
                                                  tointeger(fv!item.IdDireccion)
                                                )
                                              )
                                            ),
                                            'type!{urn:com:appian:types:RC}RC_CDT_DireccionesAreasIncidencias'(
                                              IdDireccionArea: fv!item.IdDireccion,
                                              Responsable: true(),
                                              ctlFechaModificacion: now(),
                                              ctlUsuarioModificacion: loggedInUser(),
                                              ctlFechaCreacion: now(),
                                              ctlUsuarioCreacion: loggedInUser(),
                                              ctlEstado: true()
                                            ),
                                            updatecdt(
                                              a!flatten(
                                                intersection(
                                                  index(
                                                    ri!Incidencia.Direcciones,
                                                    wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                    {}
                                                  ),
                                                  index(
                                                    ri!Incidencia.Direcciones,
                                                    wherecontains(tointeger(fv!item.IdDireccion), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                  )
                                                )
                                              ),
                                              {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                            )
                                          )
                                        ),
                                        #"SYSTEM_SYSRULES_forEach"(
                                          local!DireccionesSeleccionadas,
                                          if(
                                            or(
                                              #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                                index(
                                                  ri!Incidencia.Direcciones,
                                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                  {}
                                                )
                                              ),
                                              not(
                                                contains(
                                                  index(
                                                    index(ri!Incidencia.Direcciones, "IdDireccionArea", {}),
                                                    wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                    {}
                                                  ),
                                                  tointeger(fv!item.Id)
                                                )
                                              )
                                            ),
                                            'type!{urn:com:appian:types:RC}RC_CDT_DireccionesAreasIncidencias'(
                                              IdDireccionArea: fv!item.Id,
                                              Responsable: true(),
                                              ctlFechaModificacion: now(),
                                              ctlUsuarioModificacion: loggedInUser(),
                                              ctlFechaCreacion: now(),
                                              ctlUsuarioCreacion: loggedInUser(),
                                              ctlEstado: true()
                                            ),
                                            updatecdt(
                                              a!flatten(
                                                intersection(
                                                  index(
                                                    ri!Incidencia.Direcciones,
                                                    wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                    {}
                                                  ),
                                                  index(
                                                    ri!Incidencia.Direcciones,
                                                    wherecontains(tointeger(fv!item.Id), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                  )
                                                )
                                              ),
                                              {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                            )
                                          )
                                        )
                                      ),
                                      saveInto: {
                                        local!AreasGuardadas,
                                        #"SYSTEM_SYSRULES_forEach"(
                                          local!AreasGuardadas,
                                          if(
                                            or(
                                              #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                                index(
                                                  ri!Incidencia.Direcciones,
                                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                  {}
                                                )
                                              ),
                                              not(
                                                contains(
                                                  index(
                                                    index(ri!Incidencia.Direcciones, "IdDireccionArea", {}),
                                                    wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                    {}
                                                  ),
                                                  tointeger(fv!item.IdDireccionArea)
                                                )
                                              )
                                            ),
                                            a!save(ri!Incidencia.Direcciones, append(ri!Incidencia.Direcciones, fv!item)),
                                            a!save(
                                              ri!Incidencia.Direcciones[
                                                intersection(
                                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                  wherecontains(tointeger(fv!item.IdDireccionArea), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                )
                                              ],
                                              fv!item
                                            )
                                          )
                                        ),
                                        a!save(
                                          {
                                            local!DireccionesSeleccionadas,
                                            local!AreasSeleccionadas
                                          },
                                          null
                                        )
                                      }
                                    ),
                                    color: "ACCENT",
                                    size: "MEDIUM"
                                  )
                                },
                                showwhen: if(
                                  index(ri!Incidencia.DatosGenerales, "EntidadResponsable", true()),
                                  not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!AreasSeleccionadas)),
                                  not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!DireccionesSeleccionadas))
                                )
                              ),
                              width: "MINIMIZE"
                            )
                          }
                        )
                      },
                      alignvertical: "MIDDLE"
                    ),
                    #"SYSTEM_SYSRULES_columnsLayout"(
                      columns: {
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {},
                          width: "NARROW"
                        ),
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: with(
                            local!diccionario: #"SYSTEM_SYSRULES_forEach"(
                              index(
                                ri!Incidencia.Direcciones,
                                wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                {}
                              ),
                              {
                                direccion: if(
                                  index(ri!Incidencia.DatosGenerales, "EntidadResponsable", true()),
                                  tostring(index(index(local!queryDireccionesSBGM.data, "Direccion", {}), wherecontains(fv!item.IdDireccionArea, tointeger(index(local!queryDireccionesSBGM.data, "IdDireccion", {}))))),
                                  tostring(index(index(local!queryDireccionesNoSBGM.data, "Direccion", {}), wherecontains(fv!item.IdDireccionArea, tointeger(index(local!queryDireccionesNoSBGM.data, "Id", {})))))
                                ),
                                area: if(
                                  index(ri!Incidencia.DatosGenerales, "EntidadResponsable", true()),
                                  if(
                                    local!idiomaEsp,
                                    tostring(index(index(local!queryDireccionesSBGM.data, "AreaEsp", {}), wherecontains(fv!item.IdDireccionArea, tointeger(index(local!queryDireccionesSBGM.data, "IdDireccion", {}))))),
                                    tostring(index(index(local!queryDireccionesSBGM.data, "AreaEng", {}), wherecontains(fv!item.IdDireccionArea, tointeger(index(local!queryDireccionesSBGM.data, "IdDireccion", {})))))
                                  ),
                                  tostring(index(local!labels, "general.no-aplica"))
                                ),
                                idDireccionArea: fv!item.IdDireccionArea
                              }
                            ),
                            local!datasubsetDireccionesResponsables: todatasubset(local!diccionario, local!paginacionDireccionesResponsables),
                            {
                              #"SYSTEM_SYSRULES_gridField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                totalCount: local!datasubsetDireccionesResponsables.totalCount,
                                columns: {
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Dirección",
                                    field: "direccion",
                                    data: index(local!datasubsetDireccionesResponsables.data, "direccion", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Área",
                                    field: "area",
                                    data: index(local!datasubsetDireccionesResponsables.data, "area", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridImageColumn_v1"(
                                    label: "",
                                    data: if(
                                      local!datasubsetDireccionesResponsables.totalCount = 0,
                                      {},
                                      #"SYSTEM_SYSRULES_forEach"(
                                        local!datasubsetDireccionesResponsables.data,
                                        #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"SYSTEM_SYSRULES_iconIndicator"("REMOVE"),
                                          link: #"SYSTEM_SYSRULES_dynamicLink"(
                                            value: remove(
                                              ri!Incidencia.Direcciones,
                                              tointeger(
                                                intersection(
                                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                                                  wherecontains(tointeger(fv!item.idDireccionArea), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                )
                                              )
                                            ),
                                            saveInto: {
                                              a!save(
                                                local!paginacionDireccionesResponsables.startIndex,
                                                if(
                                                  and(
                                                    local!datasubsetDireccionesResponsables.totalCount = local!paginacionDireccionesResponsables.startIndex,
                                                    not(local!paginacionDireccionesResponsables.startIndex = 1)
                                                  ),
                                                  local!paginacionDireccionesResponsables.startIndex - local!paginacionDireccionesResponsables.batchSize,
                                                  local!paginacionDireccionesResponsables.startIndex
                                                )
                                              ),
                                              ri!Incidencia.Direcciones,
                                              if(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.Direcciones),
                                                a!save(ri!Incidencia.Direcciones, null),
                                                a!save(local!vacia, null)
                                              )
                                            }
                                          )
                                        )
                                      )
                                    ),
                                    size: "ICON"
                                  )
                                },
                                value: local!paginacionDireccionesResponsables,
                                saveInto: local!paginacionDireccionesResponsables,
                                validations: {},
                                shadeAlternateRows: true
                              )
                            }
                          )
                        )
                      },
                      showWhen: not(
                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                          index(
                            ri!Incidencia.Direcciones,
                            wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Responsable", {}))),
                            {}
                          )
                        )
                      )
                    )
                  },
                  style: "STANDARD",
                  iscollapsible: true,
                  isinitiallycollapsed: true,
                  marginBelow: "STANDARD"
                ),
                #"SYSTEM_SYSRULES_boxLayout"(
                  label: index(local!labels, "incidencia.descripcion.direccion-afectada"),
                  contents: {
                    #"SYSTEM_SYSRULES_columnsLayout"(
                      columns: {
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_sideBySideLayout"(
                              items: {
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                    label: index(local!labels, "incidencia.descripcion.direccion-afectada"),
                                    labelPosition: "ABOVE",
                                    choiceLabels: local!queryDireccionesAfectadasSBGM.data,
                                    choiceValues:
                                    #"SYSTEM_SYSRULES_forEach"(
                                      local!queryDireccionesAfectadasSBGM.data,
                                      index(
                                        index(
                                          local!queryDireccionesSBGM.data,
                                          wherecontains(tostring(fv!item), touniformstring(index(local!queryDireccionesSBGM.data, "Direccion", {}))),
                                          {}
                                        ),
                                       1,
                                       {}
                                      )
                                    ),
                                    value: local!direccionesAfectadasSeleccionadas,
                                    saveInto: local!direccionesAfectadasSeleccionadas,
                                    validations: {}
                                  )
                                ),
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                    label: "",
                                    labelPosition: "COLLAPSED",
                                    value: {
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon: "plus",
                                        caption: index(local!labels, "general.añadir"),
                                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                                          value: #"SYSTEM_SYSRULES_forEach"(
                                            local!direccionesAfectadasSeleccionadas,
                                            if(
                                              or(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                                  index(
                                                    ri!Incidencia.Direcciones,
                                                    wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                    {}
                                                  )
                                                ),
                                                not(
                                                  contains(
                                                    index(
                                                      index(ri!Incidencia.Direcciones, "IdDireccionArea", {}),
                                                      wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                      {}
                                                    ),
                                                    tointeger(fv!item.IdDireccion)
                                                  )
                                                )
                                              ),
                                              'type!{urn:com:appian:types:RC}RC_CDT_DireccionesAreasIncidencias'(
                                                IdDireccionArea: fv!item.IdDireccion,
                                                Afectada: true(),
                                                ctlFechaModificacion: now(),
                                                ctlUsuarioModificacion: loggedInUser(),
                                                ctlFechaCreacion: now(),
                                                ctlUsuarioCreacion: loggedInUser(),
                                                ctlEstado: true()
                                              ),
                                              updatecdt(
                                                a!flatten(
                                                  intersection(
                                                    index(
                                                      ri!Incidencia.Direcciones,
                                                      wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                      {}
                                                    ),
                                                    index(
                                                      ri!Incidencia.Direcciones,
                                                      wherecontains(tointeger(fv!item.Id), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                    )
                                                  )
                                                ),
                                                {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                              )
                                            )
                                          ),
                                          saveInto: {
                                            local!direccionesAfectadasGuardadas,
                                            #"SYSTEM_SYSRULES_forEach"(
                                              local!direccionesAfectadasGuardadas,
                                              if(
                                                or(
                                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                                    index(
                                                      ri!Incidencia.Direcciones,
                                                      wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                      {}
                                                    )
                                                  ),
                                                  not(
                                                    contains(
                                                      index(
                                                        index(ri!Incidencia.Direcciones, "IdDireccionArea", {}),
                                                        wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                        {}
                                                      ),
                                                      tointeger(fv!item.IdDireccionArea)
                                                    )
                                                  )
                                                ),
                                                a!save(ri!Incidencia.Direcciones, append(ri!Incidencia.Direcciones, fv!item)),
                                                a!save(
                                                  ri!Incidencia.Direcciones[
                                                    intersection(
                                                      wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                      wherecontains(tointeger(fv!item.IdDireccionArea), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                    )
                                                  ],
                                                  fv!item
                                                )
                                              )
                                            ),
                                            a!save(local!direccionesAfectadasSeleccionadas, {})
                                          }
                                        ),
                                        color: "ACCENT",
                                        size: "MEDIUM"
                                      )
                                    }
                                  ),
                                  width: "MINIMIZE",
                                  showWhen: not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!direccionesAfectadasSeleccionadas))
                                )
                              },
                              alignvertical: "MIDDLE"
                            ),
                            with(
                              local!diccionarioDireccionesAfectadas: #"SYSTEM_SYSRULES_forEach"(
                                index(
                                  ri!Incidencia.Direcciones,
                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                  {}
                                ),
                                {
                                  direccion: tostring(index(index(local!queryDireccionesSBGM.data, "Direccion", {}), wherecontains(fv!item.IdDireccionArea, tointeger(index(local!queryDireccionesSBGM.data, "IdDireccion", {}))))),
                                  idDireccionArea: fv!item.IdDireccionArea
                                }
                              ),
                              local!datasubsetDireccionesAfectadas: todatasubset(local!diccionarioDireccionesAfectadas, local!paginacionDireccionesAfectadas),
                              #"SYSTEM_SYSRULES_gridField"(
                                labelPosition: "COLLAPSED",
                                totalCount: local!datasubsetDireccionesAfectadas.totalCount,
                                columns: {
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Dirección",
                                    field: "direccion",
                                    data: index(local!datasubsetDireccionesAfectadas.data, "direccion", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridImageColumn_v1"(
                                    label: "",
                                    data: if(
                                      local!datasubsetDireccionesAfectadas.totalCount = 0,
                                      {},
                                      #"SYSTEM_SYSRULES_forEach"(
                                        local!datasubsetDireccionesAfectadas.data,
                                        #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"SYSTEM_SYSRULES_iconIndicator"("REMOVE"),
                                          link: #"SYSTEM_SYSRULES_dynamicLink"(
                                            value: remove(
                                              ri!Incidencia.Direcciones,
                                              tointeger(
                                                intersection(
                                                  wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                                  wherecontains(tointeger(fv!item.idDireccionArea), index(ri!Incidencia.Direcciones, "IdDireccionArea", {}))
                                                )
                                              )
                                            ),
                                            saveInto: {
                                              a!save(
                                                local!paginacionDireccionesAfectadas.startIndex,
                                                if(
                                                  and(
                                                    local!datasubsetDireccionesAfectadas.totalCount = local!paginacionDireccionesAfectadas.startIndex,
                                                    not(local!paginacionDireccionesAfectadas.startIndex = 1)
                                                  ),
                                                  local!paginacionDireccionesAfectadas.startIndex - local!paginacionDireccionesAfectadas.batchSize,
                                                  local!paginacionDireccionesAfectadas.startIndex
                                                )
                                              ),
                                              ri!Incidencia.Direcciones,
                                              if(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.Direcciones),
                                                a!save(ri!Incidencia.Direcciones, null),
                                                a!save(local!vacia, null)
                                              )
                                            }
                                          )
                                        )
                                      )
                                    ),
                                    size: "ICON"
                                  )
                                },
                                value: local!paginacionDireccionesAfectadas,
                                saveInto: local!paginacionDireccionesAfectadas,
                                showWhen: not(
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                    index(
                                      ri!Incidencia.Direcciones,
                                      wherecontains(true(), toboolean(index(ri!Incidencia.Direcciones, "Afectada", {}))),
                                      {}
                                    )
                                  )
                                ),
                                validations: {},
                                shadeAlternateRows: true
                              )
                            )
                          }
                        ),
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_sideBySideLayout"(
                              items: {
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                    label: index(local!labels, "incidencia.descripcion.causa-raiz"),
                                    labelPosition: "ABOVE",
                                    choiceLabels: if(
                                      local!idiomaEsp,
                                      index(local!CausasRaices, "CausaEsp", {}),
                                      index(local!CausasRaices, "CausaEng", {})
                                    ),
                                    choiceValues: index(local!CausasRaices, "IdCausa", {}),
                                    value: local!causaRaicesSeleccionadas,
                                    saveInto: local!causaRaicesSeleccionadas,
                                    validations: {}
                                  )
                                ),
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                    label: "",
                                    labelPosition: "COLLAPSED",
                                    value: {
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon: "plus",
                                        caption: index(local!labels, "general.añadir"),
                                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                                          value: #"SYSTEM_SYSRULES_forEach"(
                                            local!causaRaicesSeleccionadas,
                                            if(
                                              or(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.CausaRaiz),
                                                not(
                                                  contains(
                                                    tointeger(index(ri!Incidencia.CausaRaiz, "IdCausaRaiz", {})),
                                                    tointeger(fv!item)
                                                  )
                                                )
                                              ),
                                              'type!{urn:com:appian:types:RC}RC_CDT_CausaRaizIncidencia'(
                                                IdCausaRaiz: fv!item,
                                                ctlFechaModificacion: now(),
                                                ctlUsuarioModificacion: loggedInUser(),
                                                ctlFechaCreacion: now(),
                                                ctlUsuarioCreacion: loggedInUser(),
                                                ctlEstado: true()
                                              ),
                                              updatecdt(
                                                a!flatten(         
                                                  index(
                                                    ri!Incidencia.CausaRaiz,
                                                    wherecontains(tointeger(fv!item), index(ri!Incidencia.CausaRaiz, "IdCausaRaiz", {}))
                                                  )
                                                ),
                                                {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                              )
                                            )
                                          ),
                                          saveInto: {
                                            local!causaRaicesGuardadas,
                                            #"SYSTEM_SYSRULES_forEach"(
                                              local!causaRaicesGuardadas,
                                              if(
                                                or(
                                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.CausaRaiz),
                                                  not(
                                                    contains(
                                                      tointeger(index(ri!Incidencia.CausaRaiz, "IdCausaRaiz", {})),
                                                      tointeger(fv!item.IdCausaRaiz)
                                                    )
                                                  )
                                                ),
                                                a!save(ri!Incidencia.CausaRaiz, append(ri!Incidencia.CausaRaiz, fv!item)),
                                                a!save(
                                                  ri!Incidencia.CausaRaiz[
                                                    wherecontains(tointeger(fv!item.IdCausaRaiz), index(ri!Incidencia.CausaRaiz, "IdCausaRaiz", {}))
                                                  ],
                                                  fv!item
                                                )
                                              )
                                            ),
                                            a!save(local!causaRaicesSeleccionadas, {})
                                          }
                                        ),
                                        color: "ACCENT",
                                        size: "MEDIUM"
                                      )
                                    }
                                  ),
                                  width: "MINIMIZE",
                                  showWhen: not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!causaRaicesSeleccionadas))
                                )
                              },
                              alignvertical: "MIDDLE"
                            ),
                            with(
                              local!diccionarioCausaRaiz: #"SYSTEM_SYSRULES_forEach"(
                                ri!Incidencia.CausaRaiz,
                                {
                                  causa: if(
                                    local!idiomaEsp,
                                    tostring(
                                      index(
                                        index(local!CausasRaices, "CausaEsp", {}),
                                        wherecontains(tointeger(fv!item.IdCausaRaiz), tointeger(index(local!CausasRaices, "IdCausa", {}))),
                                        {}
                                      )
                                    ),
                                    tostring(
                                      index(
                                        index(local!CausasRaices, "CausaEng", {}),
                                        wherecontains(tointeger(fv!item.IdCausaRaiz), tointeger(index(local!CausasRaices, "IdCausa", {}))),
                                        {}
                                      )
                                    )
                                  ),
                                  idCausaRaiz: fv!item.IdCausaRaiz
                                }
                              ),
                              local!datasubsetCausaRaiz: todatasubset(local!diccionarioCausaRaiz, local!paginacionCausaRaiz),
                              #"SYSTEM_SYSRULES_gridField"(
                                labelPosition: "COLLAPSED",
                                totalCount: local!datasubsetCausaRaiz.totalCount,
                                columns: {
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Causa Raíz",
                                    field: "causa",
                                    data: index(local!datasubsetCausaRaiz.data, "causa", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridImageColumn_v1"(
                                    label: "",
                                    data: if(
                                      local!datasubsetCausaRaiz.totalCount = 0,
                                      {},
                                      #"SYSTEM_SYSRULES_forEach"(
                                        local!datasubsetCausaRaiz.data,
                                        #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"SYSTEM_SYSRULES_iconIndicator"("REMOVE"),
                                          link: #"SYSTEM_SYSRULES_dynamicLink"(
                                            value: remove(
                                              ri!Incidencia.CausaRaiz,
                                              tointeger(
                                                wherecontains(tointeger(fv!item.idCausaRaiz), index(ri!Incidencia.CausaRaiz, "IdCausaRaiz", {}))
                                              )
                                            ),
                                            saveInto: {
                                              a!save(
                                                local!paginacionCausaRaiz.startIndex,
                                                if(
                                                  and(
                                                    local!datasubsetCausaRaiz.totalCount = local!paginacionCausaRaiz.startIndex,
                                                    not(local!paginacionCausaRaiz.startIndex = 1)
                                                  ),
                                                  local!paginacionCausaRaiz.startIndex - local!paginacionCausaRaiz.batchSize,
                                                  local!paginacionCausaRaiz.startIndex
                                                )
                                              ),
                                              ri!Incidencia.CausaRaiz,
                                              if(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.CausaRaiz),
                                                a!save(ri!Incidencia.CausaRaiz, null),
                                                a!save(local!vacia, null)
                                              )
                                            }
                                          )
                                        )
                                      )
                                    ),
                                    size: "ICON"
                                  )
                                },
                                value: local!paginacionCausaRaiz,
                                saveInto: local!paginacionCausaRaiz,
                                showWhen: not(
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(
                                    index(ri!Incidencia, "CausaRaiz", {})
                                  )
                                ),
                                validations: {},
                                shadeAlternateRows: true
                              )
                            )
                          }
                        ),
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_sideBySideLayout"(
                              items: {
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                    label: index(local!labels, "incidencia.descripcion.categoria-riesgo"),
                                    labelPosition: "ABOVE",
                                    choiceLabels: if(
                                      local!idiomaEsp,
                                      index(local!CategoriasRiesgos, "RiesgoEsp", {}),
                                      index(local!CategoriasRiesgos, "RiesgoEsp", {})
                                    ),
                                    choiceValues: index(local!CategoriasRiesgos, "IdRiesgo", {}),
                                    value: local!categoriasRiesgosSeleccionadas,
                                    saveInto: local!categoriasRiesgosSeleccionadas,
                                    validations: {}
                                  )
                                ),
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                    label: "",
                                    labelPosition: "COLLAPSED",
                                    value: {
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon: "plus",
                                        caption: index(local!labels, "general.añadir"),
                                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                                          value: #"SYSTEM_SYSRULES_forEach"(
                                            local!categoriasRiesgosSeleccionadas,
                                            if(
                                              or(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.CategoriaRiesgo),
                                                not(
                                                  contains(
                                                    tointeger(index(ri!Incidencia.CategoriaRiesgo, "IdCategoriaRiesgo ", {})),
                                                    tointeger(fv!item)
                                                  )
                                                )
                                              ),
                                              'type!{urn:com:appian:types:RC}RC_CDT_CategoriaRiesgoIncidencia'(
                                                IdCategoriaRiesgo : fv!item,
                                                ctlFechaModificacion: now(),
                                                ctlUsuarioModificacion: loggedInUser(),
                                                ctlFechaCreacion: now(),
                                                ctlUsuarioCreacion: loggedInUser(),
                                                ctlEstado: true()
                                              ),
                                              updatecdt(
                                                a!flatten(         
                                                  index(
                                                    ri!Incidencia.CategoriaRiesgo,
                                                    wherecontains(tointeger(fv!item), index(ri!Incidencia.CategoriaRiesgo, "IdCategoriaRiesgo ", {}))
                                                  )
                                                ),
                                                {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                              )
                                            )
                                          ),
                                          saveInto: {
                                            local!categoriasRiesgosGuardadas,
                                            #"SYSTEM_SYSRULES_forEach"(
                                              local!categoriasRiesgosGuardadas,
                                              if(
                                                or(
                                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.CategoriaRiesgo),
                                                  not(
                                                    contains(
                                                      tointeger(index(ri!Incidencia.CategoriaRiesgo, "IdCategoriaRiesgo", {})),
                                                      tointeger(fv!item.IdCategoriaRiesgo)
                                                    )
                                                  )
                                                ),
                                                a!save(ri!Incidencia.CategoriaRiesgo, append(ri!Incidencia.CategoriaRiesgo, fv!item)),
                                                a!save(
                                                  ri!Incidencia.CategoriaRiesgo[
                                                    wherecontains(tointeger(fv!item.IdCategoriaRiesgo), index(ri!Incidencia.CategoriaRiesgo, "IdCategoriaRiesgo", {}))
                                                  ],
                                                  fv!item
                                                )
                                              )
                                            ),
                                            a!save(local!categoriasRiesgosSeleccionadas, {})
                                          }
                                        ),
                                        color: "ACCENT",
                                        size: "MEDIUM"
                                      )
                                    }
                                  ),
                                  width: "MINIMIZE",
                                  showWhen: not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!categoriasRiesgosSeleccionadas))
                                )
                              },
                              alignvertical: "MIDDLE"
                            ),
                            with(
                              local!diccionarioCategoriaRiesgo: #"SYSTEM_SYSRULES_forEach"(
                                ri!Incidencia.CategoriaRiesgo,
                                {
                                  categoriaRiesgo: if(
                                    local!idiomaEsp,
                                    tostring(
                                      index(
                                        index(local!CategoriasRiesgos, "RiesgoEsp", {}),
                                        wherecontains(tointeger(fv!item.IdCategoriaRiesgo), tointeger(index(local!CategoriasRiesgos, "IdRiesgo", {}))),
                                        {}
                                      )
                                    ),
                                    tostring(
                                      index(
                                        index(local!CategoriasRiesgos, "RiesgoEng", {}),
                                        wherecontains(tointeger(fv!item.IdCategoriaRiesgo), tointeger(index(local!CategoriasRiesgos, "IdRiesgo", {}))),
                                        {}
                                      )
                                    )
                                  ),
                                  idCategoriaRiesgo: fv!item.IdCategoriaRiesgo
                                }
                              ),
                              local!datasubsetCategoriaRiesgo: todatasubset(local!diccionarioCategoriaRiesgo, local!paginacionCategoriaRiesgo),
                              #"SYSTEM_SYSRULES_gridField"(
                                labelPosition: "COLLAPSED",
                                totalCount: local!datasubsetCategoriaRiesgo.totalCount,
                                columns: {
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Categoría del Riesgo",
                                    field: "categoriaRiesgo",
                                    data: index(local!datasubsetCategoriaRiesgo.data, "categoriaRiesgo", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridImageColumn_v1"(
                                    label: "",
                                    data: if(
                                      local!datasubsetCategoriaRiesgo.totalCount = 0,
                                      {},
                                      #"SYSTEM_SYSRULES_forEach"(
                                        local!datasubsetCategoriaRiesgo.data,
                                        #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"SYSTEM_SYSRULES_iconIndicator"("REMOVE"),
                                          link: #"SYSTEM_SYSRULES_dynamicLink"(
                                            value: remove(
                                              ri!Incidencia.CategoriaRiesgo,
                                              tointeger(
                                                wherecontains(tointeger(fv!item.idCategoriaRiesgo), index(ri!Incidencia.CategoriaRiesgo, "IdCategoriaRiesgo", {}))
                                              )
                                            ),
                                            saveInto: {
                                              a!save(
                                                local!paginacionCategoriaRiesgo.startIndex,
                                                if(
                                                  and(
                                                    local!datasubsetCategoriaRiesgo.totalCount = local!paginacionCategoriaRiesgo.startIndex,
                                                    not(local!paginacionCategoriaRiesgo.startIndex = 1)
                                                  ),
                                                  local!paginacionCategoriaRiesgo.startIndex - local!paginacionCategoriaRiesgo.batchSize,
                                                  local!paginacionCategoriaRiesgo.startIndex
                                                )
                                              ),
                                              ri!Incidencia.CategoriaRiesgo,
                                              if(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.CategoriaRiesgo),
                                                a!save(ri!Incidencia.CategoriaRiesgo, null),
                                                a!save(local!vacia, null)
                                              )
                                            }
                                          )
                                        )
                                      )
                                    ),
                                    size: "ICON"
                                  )
                                },
                                value: local!paginacionCategoriaRiesgo,
                                saveInto: local!paginacionCategoriaRiesgo,
                                showWhen: not(
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(ri!Incidencia, "CategoriaRiesgo", {}))
                                ),
                                validations: {},
                                shadeAlternateRows: true
                              )
                            )
                          }
                        )
                      }
                    )
                  },
                  showwhen: true,
                  style: "STANDARD",
                  iscollapsible: true,
                  isinitiallycollapsed: true,
                  marginBelow: "STANDARD"
                ),
                #"SYSTEM_SYSRULES_boxLayout"(
                  label: index(local!labels, "incidencia.descripcion.informacion-adicional"),
                  contents: {
                    #"SYSTEM_SYSRULES_columnsLayout"(
                      columns: {
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_textField"(
                              label: index(local!labels ,"incidencia.descripcion.operacion-afectada"),
                              labelPosition: "ABOVE",
                              value: index(index(ri!Incidencia, "DatosGenerales", {}), "OperacionAfectada", null),
                              saveInto: ri!Incidencia.DatosGenerales.OperacionAfectada,
                              validations: if(
                                len(index(index(ri!Incidencia, "DatosGenerales", {}), "OperacionAfectada", null)) &gt; 255,
                                "La longitud del valor no puede ser superior a 255 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "OperacionAfectada", null)) &amp; " caracteres.",
                                null
                              )
                            ),
                            #"SYSTEM_SYSRULES_checkboxField"(
                              choiceLabels: {
                                index(local!labels, "incidencia.descripcion.evento-riesgos-propios")
                              },
                              choiceValues: {
                                true
                              },
                              value: if(
                                index(index(ri!Incidencia, "DatosGenerales", {}), "EventoRiesgosPropiosHeracles", null),
                                true,
                                null
                              ),
                              saveInto: a!save(
                                ri!Incidencia.DatosGenerales.EventoRiesgosPropiosHeracles,
                                if(
                                  isnull(
                                    save!value
                                  ),
                                  false,
                                  true
                                )
                              )
                            ),
                            #"SYSTEM_SYSRULES_textField"(
                              label: index(local!labels, "incidencia.descripcion.id-heracles"),
                              labelPosition: "ABOVE",
                              value: ri!Incidencia.DatosGenerales.CodigoHeracles,
                              saveInto: ri!Incidencia.DatosGenerales.CodigoHeracles,
                              showwhen: if(
                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "EventoRiesgosPropiosHeracles", null)),
                                false(),
                                index(index(ri!Incidencia, "DatosGenerales", {}), "EventoRiesgosPropiosHeracles", false())
                              ),
                              validations: if(
                                len(index(index(ri!Incidencia, "DatosGenerales", {}), "CodigoHeracles")) &gt; 255,
                                "La longitud del valor no puede ser superior a 255 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "CodigoHeracles", null)) &amp; " caracteres.",
                                null
                              )
                            )
                          }
                        ),
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_sideBySideLayout"(
                              items: {
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                    label: index(local!labels, "incidencia.descripcion.producto-afectado"),
                                    labelPosition: "ABOVE",
                                    choiceLabels: if(
                                      local!idiomaEsp,
                                      index(local!ProductosAfectados, "ProductoEsp", {}),
                                      index(local!ProductosAfectados, "ProductoEng",{})
                                    ),
                                    choiceValues: index(local!ProductosAfectados, "IdProducto", {}),
                                    value: local!productosAfectadosSeleccionados,
                                    saveInto: local!productosAfectadosSeleccionados,
                                    validations: {}
                                  )
                                ),
                                #"SYSTEM_SYSRULES_sideBySideItem"(
                                  item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                    label: "",
                                    labelPosition: "COLLAPSED",
                                    value: {
                                      #"SYSTEM_SYSRULES_richTextIcon"(
                                        icon: "plus",
                                        caption: index(local!labels, "general.añadir"),
                                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                                          value: #"SYSTEM_SYSRULES_forEach"(
                                            local!productosAfectadosSeleccionados,
                                            if(
                                              or(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ProductoAfectado),
                                                not(
                                                  contains(
                                                    tointeger(index(ri!Incidencia.ProductoAfectado, "IdTaxonomia ", {})),
                                                    tointeger(fv!item)
                                                  )
                                                )
                                              ),
                                              'type!{urn:com:appian:types:RC}RC_CDT_ProductoAfectadoIncidencia'(
                                                IdTaxonomia : fv!item,
                                                ctlFechaModificacion: now(),
                                                ctlUsuarioModificacion: loggedInUser(),
                                                ctlFechaCreacion: now(),
                                                ctlUsuarioCreacion: loggedInUser(),
                                                ctlEstado: true()
                                              ),
                                              updatecdt(
                                                a!flatten(         
                                                  index(
                                                    ri!Incidencia.ProductoAfectado,
                                                    wherecontains(tointeger(fv!item), index(ri!Incidencia.ProductoAfectado, "IdTaxonomia ", {}))
                                                  )
                                                ),
                                                {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                              )
                                            )
                                          ),
                                          saveInto: {
                                            local!productosAfectadosGuardados,
                                            #"SYSTEM_SYSRULES_forEach"(
                                              local!productosAfectadosGuardados,
                                              if(
                                                or(
                                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ProductoAfectado),
                                                  not(
                                                    contains(
                                                      tointeger(index(ri!Incidencia.ProductoAfectado, "IdTaxonomia", {})),
                                                      tointeger(fv!item.IdTaxonomia)
                                                    )
                                                  )
                                                ),
                                                a!save(ri!Incidencia.ProductoAfectado, append(ri!Incidencia.ProductoAfectado, fv!item)),
                                                a!save(
                                                  ri!Incidencia.ProductoAfectado[
                                                    wherecontains(tointeger(fv!item.IdTaxonomia), index(ri!Incidencia.ProductoAfectado, "IdTaxonomia", {}))
                                                  ],
                                                  fv!item
                                                )
                                              )
                                            ),
                                            a!save(local!productosAfectadosSeleccionados, {})
                                          }
                                        ),
                                        color: "ACCENT",
                                        size: "MEDIUM"
                                      )
                                    }
                                  ),
                                  width: "MINIMIZE",
                                  showWhen: not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!productosAfectadosSeleccionados))
                                )
                              },
                              alignvertical: "MIDDLE"
                            ),
                            with(
                              local!diccionarioProductoAfectado: #"SYSTEM_SYSRULES_forEach"(
                                ri!Incidencia.ProductoAfectado,
                                {
                                  producto: if(
                                    local!idiomaEsp,
                                    tostring(
                                      index(
                                        index(local!ProductosAfectados, "ProductoEsp", {}),
                                        wherecontains(tointeger(fv!item.IdTaxonomia), tointeger(index(local!ProductosAfectados, "IdProducto", {}))),
                                        {}
                                      )
                                    ),
                                    tostring(
                                      index(
                                        index(local!ProductosAfectados, "ProductoEng", {}),
                                        wherecontains(tointeger(fv!item.IdTaxonomia), tointeger(index(local!ProductosAfectados, "IdProducto", {}))),
                                        {}
                                      )
                                    )
                                  ),
                                  idTaxonomiaRegistro: fv!item.IdTaxonomia
                                }
                              ),
                              local!datasubsetProductoAfectado: todatasubset(local!diccionarioProductoAfectado, local!paginacionProductoAfectado),
                              #"SYSTEM_SYSRULES_gridField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                totalCount: local!datasubsetProductoAfectado.totalCount,
                                columns: {
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Producto Afectado",
                                    field: "producto",
                                    data: index(local!datasubsetProductoAfectado.data, "producto", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridImageColumn_v1"(
                                    label: "",
                                    data: if(
                                      local!datasubsetProductoAfectado.totalCount = 0,
                                      {},
                                      #"SYSTEM_SYSRULES_forEach"(
                                        local!datasubsetProductoAfectado.data,
                                        #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"SYSTEM_SYSRULES_iconIndicator"("REMOVE"),
                                          link: #"SYSTEM_SYSRULES_dynamicLink"(
                                            value: remove(
                                              ri!Incidencia.ProductoAfectado,
                                              tointeger(
                                                wherecontains(tointeger(fv!item.idTaxonomiaRegistro), tointeger(index(ri!Incidencia.ProductoAfectado, "IdTaxonomia", {})))
                                              )
                                            ),
                                            saveInto: {
                                              a!save(
                                                local!paginacionProductoAfectado.startIndex,
                                                if(
                                                  and(
                                                    local!datasubsetProductoAfectado.totalCount = local!paginacionProductoAfectado.startIndex,
                                                    not(local!paginacionProductoAfectado.startIndex = 1)
                                                  ),
                                                  local!paginacionProductoAfectado.startIndex - local!paginacionProductoAfectado.batchSize,
                                                  local!paginacionProductoAfectado.startIndex
                                                )
                                              ),
                                              ri!Incidencia.ProductoAfectado,
                                              if(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ProductoAfectado),
                                                a!save(ri!Incidencia.ProductoAfectado, null),
                                                a!save(local!vacia, null)
                                              )
                                            }
                                          )
                                        )
                                      )
                                    ),
                                    size: "ICON"
                                  )
                                },
                                value: local!paginacionProductoAfectado,
                                saveInto: local!paginacionProductoAfectado,
                                showWhen: not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ProductoAfectado)),
                                validations: {},
                                shadeAlternateRows: true
                              )
                            )
                          }
                        )
                      }
                    ),
                    #"SYSTEM_SYSRULES_columnsLayout"(
                      columns: {
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_columnsLayout"(
                              columns: {
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_radioButtonField"(
                                      label: index(local!labels, "incidencia.descripcion.servicio-afectado"),
                                      labelposition: "ABOVE",
                                      choiceLabels: {
                                        index(local!labels, "general.si"),
                                        index(local!labels, "general.no")
                                      },
                                      choiceValues: {
                                        true(),
                                        false()
                                      },
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "ServicioAfectado", null),
                                      saveInto: ri!Incidencia.DatosGenerales.ServicioAfectado
                                    )
                                  }
                                ),
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_paragraphField"(
                                      label: index(local!labels, "general.motivo"),
                                      labelPosition: "ABOVE",
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoServicioNoAfectado", null),
                                      saveInto: ri!Incidencia.DatosGenerales.MotivoServicioNoAfectado,
                                      showwhen: if(
                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "ServicioAfectado", null)),
                                        false(),
                                        not(index(index(ri!Incidencia, "DatosGenerales", {}), "ServicioAfectado", true()))
                                      ),
                                      validations: if(
                                        len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoServicioNoAfectado", null)) &gt; 1000,
                                        "La longitud del valor no puede ser superior a 1000 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoServicioNoAfectado")) &amp; " caracteres.",
                                        null
                                      )
                                    )
                                  }
                                )
                              }
                            )
                          }
                        ),
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_columnsLayout"(
                              columns: {
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_radioButtonField"(
                                      label: index(local!labels, "incidencia.descripcion.aplica-plan"),
                                      choiceLabels: {
                                        index(local!labels, "general.si"),
                                        index(local!labels, "general.no")
                                      },
                                      choiceValues: {
                                        true(),
                                        false()
                                      },
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "AplicaPlanDeAccion", null),
                                      saveInto: ri!Incidencia.DatosGenerales.AplicaPlanDeAccion
                                    )
                                  }
                                ),
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_paragraphField"(
                                      label: index(local!labels, "general.motivo"),
                                      labelPosition: "ABOVE",
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoAplicaServicio", null),
                                      saveInto: ri!Incidencia.DatosGenerales.MotivoNoAplicaServicio,
                                      showWhen: if(
                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "AplicaPlanDeAccion", null)),
                                        false(),
                                        not(index(index(ri!Incidencia, "DatosGenerales", {}), "AplicaPlanDeAccion", true()))
                                      ),
                                      validations: if(
                                        len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoAplicaServicio", null)) &gt; 1000,
                                        "La longitud del valor no puede ser superior a 1000 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoAplicaServicio", null)) &amp; " caracteres.",
                                        null
                                      )
                                    )
                                  }
                                )
                              }
                            )
                          }
                        )
                      }
                    ),
                    #"SYSTEM_SYSRULES_columnsLayout"(
                      columns: {
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_columnsLayout"(
                              columns: {
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_radioButtonField"(
                                      label: index(local!labels, "incidencia.descripcion.control-heracles-fallado"),
                                      choiceLabels: {
                                        index(local!labels, "general.si"),
                                        index(local!labels, "general.no")
                                      },
                                      choiceValues: {
                                        true(),
                                        false()
                                      },
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", null),
                                      saveInto: {
                                        ri!Incidencia.DatosGenerales.ControlHeracles,
                                        if(
                                          ri!Incidencia.DatosGenerales.ControlHeracles,
                                          a!save(ri!Incidencia.DatosGenerales.MotivoNoHayControlHeracles, null),
                                          a!save(ri!Incidencia.ControlIdHeracles, null)
                                        )
                                      }
                                    )
                                  }
                                ),
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_sideBySideLayout"(
                                      items: {
                                        #"SYSTEM_SYSRULES_sideBySideItem"(
                                          item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                            label: index(local!labels, "incidencia.descripcion.control-id-heracles"),
                                            labelPosition: "ABOVE",
                                            choiceLabels: #"SYSTEM_SYSRULES_forEach"(
                                              local!ControlIDHeraclesDropdown,
                                              joinarray({fv!item.IdControl, fv!item.NombreControl}, "-")
                                            ),
                                            choiceValues: index(local!ControlIDHeraclesDropdown, "IdControl", {}),
                                            value: local!controlesHeraclesSeleccionados,
                                            saveInto: local!controlesHeraclesSeleccionados,
                                            validations: {}
                                          )
                                        ),
                                        #"SYSTEM_SYSRULES_sideBySideItem"(
                                          item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                            label: "",
                                            labelPosition: "COLLAPSED",
                                            value: {
                                              #"SYSTEM_SYSRULES_richTextIcon"(
                                                icon: "plus",
                                                caption: index(local!labels, "general.añadir"),
                                                link: #"SYSTEM_SYSRULES_dynamicLink"(
                                                  value: #"SYSTEM_SYSRULES_forEach"(
                                                    local!controlesHeraclesSeleccionados,
                                                    if(
                                                      or(
                                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ControlIdHeracles),
                                                        not(
                                                          contains(
                                                            tointeger(index(ri!Incidencia.ControlIdHeracles, "IdHeracles ", {})),
                                                            tointeger(fv!item)
                                                          )
                                                        )
                                                      ),
                                                      'type!{urn:com:appian:types:RC}RC_CDT_ControlHeraclesIncidencia'(
                                                        IdHeracles: fv!item,
                                                        ctlFechaModificacion: now(),
                                                        ctlUsuarioModificacion: loggedInUser(),
                                                        ctlFechaCreacion: now(),
                                                        ctlUsuarioCreacion: loggedInUser(),
                                                        ctlEstado: true()
                                                      ),
                                                      updatecdt(
                                                        a!flatten(
                                                          index(
                                                            ri!Incidencia.ControlIdHeracles,
                                                            wherecontains(tointeger(fv!item), index(ri!Incidencia.ControlIdHeracles, "IdHeracles ", {}))
                                                          )
                                                        ),
                                                        {ctlFechaModificacion: now(), ctlUsuarioModificacion: loggedInUser(), ctlEstado: true()}
                                                      )
                                                    )
                                                  ),
                                                  saveInto: {
                                                    local!controlesHeraclesGuardados,
                                                    #"SYSTEM_SYSRULES_forEach"(
                                                      local!controlesHeraclesGuardados,
                                                      if(
                                                        or(
                                                          #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ControlIdHeracles),
                                                          not(
                                                            contains(
                                                              tointeger(index(ri!Incidencia.ControlIdHeracles, "IdHeracles", {})),
                                                              tointeger(fv!item.IdHeracles)
                                                            )
                                                          )
                                                        ),
                                                        a!save(ri!Incidencia.ControlIdHeracles, append(ri!Incidencia.ControlIdHeracles, fv!item)),
                                                        a!save(
                                                          ri!Incidencia.ControlIdHeracles[
                                                            wherecontains(tointeger(fv!item.IdHeracles), index(ri!Incidencia.ControlIdHeracles, "IdHeracles", {}))
                                                          ],
                                                          fv!item
                                                        )
                                                      )
                                                    ),
                                                    a!save(local!controlesHeraclesSeleccionados, {})
                                                  }
                                                ),
                                                color: "ACCENT",
                                                size: "MEDIUM"
                                              )
                                            }
                                          ),
                                          width: "MINIMIZE",
                                          showWhen: not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(local!controlesHeraclesSeleccionados))
                                        )
                                      },
                                      alignvertical: "MIDDLE",
                                      showwhen: if(
                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", null)),
                                        false(),
                                        index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", false())
                                      )
                                    ),
                                    #"SYSTEM_SYSRULES_paragraphField"(
                                      label: index(local!labels, "general.motivo"),
                                      labelPosition: "ABOVE",
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoHayControlHeracles", null),
                                      saveInto: ri!Incidencia.DatosGenerales.MotivoNoHayControlHeracles,
                                      showwhen: if(
                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", null)),
                                        false(),
                                        not(index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", true()))
                                      ),
                                      validations: if(
                                        len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoHayControlHeracles", null)) &gt; 1000,
                                        "La longitud del valor no puede ser superior a 1000 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoHayControlHeracles", null)) &amp; " caracteres.",
                                        null
                                      )
                                    )
                                  }
                                )
                              }
                            ),
                            with(
                              local!diccionarioControlIdHeracles: #"SYSTEM_SYSRULES_forEach"(
                                ri!Incidencia.ControlIdHeracles,
                                {
                                  controlID: joinarray(
                                    {
                                      index(fv!item, "IdHeracles", {}),
                                      index(
                                        index(local!ControlIDHeracles, "NombreControl", {}),
                                        wherecontains(tointeger(fv!item.IdHeracles), tointeger(index(local!ControlIDHeracles, "IdControl", {}))),
                                        {}
                                      )
                                    },
                                    "-"
                                  ),
                                  idHeraclesRegistro: fv!item.IdHeracles
                                }
                              ),
                              local!datasubsetControlIdHeracles: todatasubset(local!diccionarioControlIdHeracles, local!paginacionControlesHeracles),
                              #"SYSTEM_SYSRULES_gridField"(
                                label: "",
                                labelPosition: "COLLAPSED",
                                totalCount: local!datasubsetControlIdHeracles.totalCount,
                                columns: {
                                  #"SYSTEM_SYSRULES_gridTextColumn"(
                                    label: "Control ID Heracles",
                                    field: "controlID",
                                    data: index(local!datasubsetControlIdHeracles.data, "controlID", {})
                                  ),
                                  #"SYSTEM_SYSRULES_gridImageColumn_v1"(
                                    label: "",
                                    data: if(
                                      local!datasubsetControlIdHeracles.totalCount = 0,
                                      {},
                                      #"SYSTEM_SYSRULES_forEach"(
                                        local!datasubsetControlIdHeracles.data,
                                        #"SYSTEM_SYSRULES_documentImage"(
                                          document: #"SYSTEM_SYSRULES_iconIndicator"("REMOVE"),
                                          link: #"SYSTEM_SYSRULES_dynamicLink"(
                                            value: remove(
                                              ri!Incidencia.ControlIdHeracles,
                                              tointeger(
                                                wherecontains(tointeger(fv!item.idHeraclesRegistro), tointeger(index(ri!Incidencia.ControlIdHeracles, "IdHeracles", {})))
                                              )
                                            ),
                                            saveInto: {
                                              a!save(
                                                local!paginacionControlesHeracles.startIndex,
                                                if(
                                                  and(
                                                    local!datasubsetControlIdHeracles.totalCount = local!paginacionControlesHeracles.startIndex,
                                                    not(local!paginacionControlesHeracles.startIndex = 1)
                                                  ),
                                                  local!paginacionControlesHeracles.startIndex - local!paginacionControlesHeracles.batchSize,
                                                  local!paginacionControlesHeracles.startIndex
                                                )
                                              ),
                                              ri!Incidencia.ControlIdHeracles,
                                              if(
                                                #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ControlIdHeracles),
                                                a!save(ri!Incidencia.ControlIdHeracles, null),
                                                a!save(local!vacia, null)
                                              )
                                            }
                                          )
                                        )
                                      )
                                    ),
                                    size: "ICON"
                                  )
                                },
                                value: local!paginacionControlesHeracles,
                                saveInto: local!paginacionControlesHeracles,
                                showwhen: and(
                                  if(
                                    #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", null)),
                                    false(),
                                    index(index(ri!Incidencia, "DatosGenerales", {}), "ControlHeracles", false())
                                  ),
                                  not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.ControlIdHeracles))
                                ),
                                validations: {},
                                shadeAlternateRows: true
                              )
                            )
                          }
                        ),
                        #"SYSTEM_SYSRULES_columnLayout"(
                          contents: {
                            #"SYSTEM_SYSRULES_columnsLayout"(
                              columns: {
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_radioButtonField"(
                                      label: index(local!labels, "incidencia.descripcion.subproceso-bia-arka-afectado"),
                                      choiceLabels: {
                                        index(local!labels, "general.si"),
                                        index(local!labels, "general.no")
                                      },
                                      choiceValues: {
                                        true(),
                                        false()
                                      },
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", null),
                                      saveInto: ri!Incidencia.DatosGenerales.SubprocesoBIA
                                    )
                                  }
                                ),
                                #"SYSTEM_SYSRULES_columnLayout"(
                                  contents: {
                                    #"SYSTEM_SYSRULES_paragraphField"(
                                      label: index(local!labels, "general.motivo"),
                                      labelPosition: "ABOVE",
                                      value: index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoSubprocesoBIA", null),
                                      saveInto: ri!Incidencia.DatosGenerales.MotivoNoSubprocesoBIA,
                                      showwhen: if(
                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", null)),
                                        false(),
                                        not(index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", true()))
                                      ),
                                      validations: if(
                                        len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoSubprocesoBIA", null)) &gt; 1000,
                                        "La longitud del valor no puede ser superior a 1000 caracteres. Ha escrito " &amp; len(index(index(ri!Incidencia, "DatosGenerales", {}), "MotivoNoSubprocesoBIA", null)) &amp; " caracteres.",
                                        null
                                      )
                                    ),
                                    #"SYSTEM_SYSRULES_sideBySideLayout"(
                                      items: {
                                        #"SYSTEM_SYSRULES_sideBySideItem"(
                                          item: #"SYSTEM_SYSRULES_multipleDropdownField"(
                                            label: index(local!labels, "incidencia.descripcion.subproceso-bia"),
                                            labelPosition: "ABOVE",
                                            choiceLabels: {"Opción 1", "Opción 2"},
                                            choiceValues: {1, 2},
                                            saveInto: {},
                                            validations: {}
                                          )
                                        ),
                                        #"SYSTEM_SYSRULES_sideBySideItem"(
                                          item: #"SYSTEM_SYSRULES_richTextDisplayField"(
                                            label: "",
                                            labelPosition: "COLLAPSED",
                                            value: {
                                              #"SYSTEM_SYSRULES_richTextIcon"(
                                                icon: "plus",
                                                color: "ACCENT",
                                                size: "MEDIUM"
                                              )
                                            }
                                          ),
                                          width: "MINIMIZE"
                                        )
                                      },
                                      alignvertical: "MIDDLE",
                                      showwhen: if(
                                        #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", null)),
                                        false(),
                                        index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", false())
                                      )
                                    )
                                  }
                                )
                              }
                            ),
                            #"SYSTEM_SYSRULES_gridField"(
                              label: "",
                              labelPosition: "ABOVE",
                              totalCount: 0,
                              columns: {
                                #"SYSTEM_SYSRULES_gridTextColumn"(
                                  label: "Columna de texto",
                                  data: {}
                                )
                              },
                              value: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1, batchSize: 5),
                              saveInto: {},
                              showwhen: and(
                                if(
                                  #"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", null)),
                                  false(),
                                  index(index(ri!Incidencia, "DatosGenerales", {}), "SubprocesoBIA", false())
                                ),
                                not(#"_a-0000e1f2-c7ff-8000-9ba2-011c48011c48_4159842"(ri!Incidencia.SubprocesoBIA))
                              ),
                              validations: {},
                              shadeAlternateRows: true
                            )
                          }
                        )
                      }
                    )
                  },
                  style: "STANDARD",
                  iscollapsible: true,
                  isinitiallycollapsed: true,
                  marginBelow: "STANDARD"
                )
              },
              style: "NONE",
              height: "AUTO",
              marginBelow: "STANDARD"
            )
          },
          isinitiallycollapsed: true
        ),
        #"_a-0000e49e-d6a5-8000-9ba2-011c48011c48_8506125"(
          labels: local!labels,
          Incidencia: ri!Incidencia,
          proceso: ri!proceso,
          Geografias: local!geografias,
          Impactos: local!impactos,
          idiomaEsp: local!idiomaEsp,
          usuarioLogado: local!queryUsuarioLogado
        ),
        /*rule!RC_IF_Servicios(*/
          /*labels: local!labels,*/
          /*Incidencia: ri!Incidencia.DatosGenerales,*/
          /*proceso: ri!proceso*/
        /*),*/
        #"_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8535677"(
          labels: local!labels,
          Incidencia: ri!Incidencia.DatosGenerales,
          proceso: ri!proceso,
          idiomaEsp: local!idiomaEsp,
          Documentacion: local!docu
        )
      },
      style: "ACCENT",
      marginBelow: "STANDARD"
    ),
    #"SYSTEM_SYSRULES_sideBySideLayout"(
      items: {
        #"SYSTEM_SYSRULES_sideBySideItem"(
          item: #"SYSTEM_SYSRULES_richTextDisplayField"(
            label: "",
            labelPosition: "ABOVE",
            value: {
              #"SYSTEM_SYSRULES_richTextItem_v1"(
                text: repeat(1, char(9))
              ),
              #"SYSTEM_SYSRULES_richTextIcon"(
                icon: "eraser",
                color: "ACCENT",
                size: "LARGE"
              ),
              #"SYSTEM_SYSRULES_richTextItem_v1"(
                text: repeat(1, char(9))
              ),
              #"SYSTEM_SYSRULES_richTextIcon"(
                icon: "save",
                color: "ACCENT",
                size: "LARGE"

              )
            }
          )
        ),
        #"SYSTEM_SYSRULES_sideBySideItem"(
          item: #"SYSTEM_SYSRULES_richTextDisplayField"(
            label: "",
            labelPosition: "COLLAPSED",
            value: {
              /*a!richTextIcon(*/
                /*icon: "trash-o",*/
                /*color: "NEGATIVE",*/
                /*size: "LARGE"*/
              /*),*/
              /*a!richTextItem(*/
                /*text: repeat(1, char(9))*/
              /*),*/
              /*a!richTextIcon(*/
                /*icon: "pencil",*/
                /*color: "ACCENT",*/
                /*size: "LARGE"*/
              /*),*/
              /*a!richTextItem(*/
                /*text: repeat(1, char(9))*/
              /*),*/
              /*a!richTextIcon(*/
                /*icon: "plus",*/
                /*color: "ACCENT",*/
                /*size: "LARGE"*/
              /*),*/
              #"SYSTEM_SYSRULES_richTextIcon"(
                icon: "plus-circle",
                color: "ACCENT",
                size: "LARGE"
              ),
              /*a!richTextIcon(*/
                /*icon: "plus-square",*/
                /*color: "ACCENT",*/
                /*size: "LARGE"*/
              /*),*/
              /*a!richTextIcon(*/
                /*icon: "plus-square-o",*/
                /*color: "ACCENT",*/
                /*size: "LARGE"*/
              /*),*/
              #"SYSTEM_SYSRULES_richTextItem_v1"(
                text: repeat(1, char(9))
              )
            },
            align: "RIGHT"
          )
        )
      },
      alignvertical: "BOTTOM"
    )
  }
)</definition>
        <namedTypedValue>
            <name>Incidencia</name>
            <type>
                <name>RC_CDT_ProcesoIncidencia</name>
                <namespace>urn:com:appian:types:RC</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>proceso</name>
            <type>
                <name>ProcessModel</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000e4a8-06eb-8000-9ba2-011c48011c48_8584709"/>
    </history>
</contentHaul>
